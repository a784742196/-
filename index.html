<!doctype html>
<html lang="zh-CN">
<head>
Â Â <meta charset="utf-8" />
Â Â <meta name="viewport" content="width=device-width,initial-scale=1" />
Â Â <title>å³æ—¶å…‘æ¢æ±‡ç‡å¯¹æ¯”ï¼ˆä¸­æ–‡ï¼‰</title>
Â Â <style>
Â Â Â Â body { font-family: -apple-system, "Helvetica Neue", Arial; margin: 12px; }
Â Â Â Â input, button, select { font-size: 16px; padding: 4px; border-radius: 4px; border: 1px solid #ccc; }
Â Â Â Â table { width: 100%; border-collapse: collapse; margin-top: 10px; }
Â Â Â Â th, td { border-bottom: 1px solid #ddd; padding: 8px; text-align:left; }
Â Â Â Â .ok { color: green; } .err { color: #c00; }
Â Â Â Â .small { font-size: 13px; color: #666; }
Â Â Â Â .adapter-item { border: 1px solid #eee; padding: 8px; margin: 6px 0; border-radius: 4px; background: #f9f9f9; }
Â Â Â Â .section-title { margin-top: 20px; border-bottom: 2px solid #555; padding-bottom: 5px; }
Â Â </style>
</head>
<body>
Â Â <h2>ğŸª™ å³æ—¶å…‘æ¢æ±‡ç‡å¯¹æ¯”</h2>
Â Â <div>
Â Â Â Â <label>å¸ç§From:<input id="from" value="BTC" style="width:80px"></label>
Â Â Â Â <label>å¸ç§To:<input id="to" value="USDT" style="width:80px"></label>
Â Â Â Â <button id="compare">ä¸€é”®æ¯”ä»·</button>
Â Â Â Â <button id="addAdapter">æ–°å¢äº¤æ˜“æ‰€</button>
Â Â Â Â <button id="loadExample">è½½å…¥ç¤ºä¾‹</button>
Â Â </div>
Â Â <div class="small" style="margin-bottom: 10px;">é€‚é…å™¨å·²è‡ªåŠ¨ä¿å­˜åœ¨æµè§ˆå™¨ä¸­ã€‚</div>
Â Â <div id="adapterList"></div>

Â Â <h3 class="section-title">ğŸ“Š æ±‡ç‡ç»“æœ</h3>
Â Â <div id="status" class="small">å°šæœªæŸ¥è¯¢</div>

Â Â <h4 style="color: #007bff;">æµ®åŠ¨æ±‡ç‡å¯¹æ¯”</h4>
Â Â <table id="floatingTable"><thead><tr><th>äº¤æ˜“æ‰€</th><th>æ±‡ç‡</th><th>æ“ä½œ</th></tr></thead><tbody></tbody></table>

Â Â <h4 style="color: #28a745;">é”å®šæ±‡ç‡å¯¹æ¯”</h4>
Â Â <table id="lockedTable"><thead><tr><th>äº¤æ˜“æ‰€</th><th>æ±‡ç‡</th><th>æ“ä½œ</th></tr></thead><tbody></tbody></table>

<script>
const WORKER_URL = 'https://lingering-scene-1e28.yanfei6868.workers.dev';

let adapters = JSON.parse(localStorage.getItem('adapters_v2') || '[]');
function saveAdapters() { localStorage.setItem('adapters_v2', JSON.stringify(adapters)); }
function escapeHtml(s){ return s? s.replace(/"/g,'&quot;').replace(/</g,'&lt;') : ''; }

function renderAdapters() {
Â Â const container = document.getElementById('adapterList');
Â Â container.innerHTML = '';
Â Â adapters.forEach((a, i) => {
Â Â Â Â const div = document.createElement('div');
Â Â Â Â div.className = 'adapter-item';
Â Â Â Â div.innerHTML = `
Â Â Â Â Â Â <b>${a.name || ('é€‚é…å™¨ ' + (i+1))}</b><br>
Â Â Â Â Â Â <div class="small">URLæ¨¡æ¿: <input data-i="${i}" class="url" value="${escapeHtml(a.urlTemplate||'')}" style="width:90%"></div>
Â Â Â Â Â Â <div class="small">é“¾æ¥æ¨¡æ¿: <input data-i="${i}" class="linkTemplate" value="${escapeHtml(a.linkTemplate||'')}" style="width:90%"></div>
Â Â Â Â Â Â <div class="small">
Â Â Â Â Â Â Â Â <label>ç±»å‹: 
Â Â Â Â Â Â Â Â Â Â <select data-i="${i}" class="rateType">
Â Â Â Â Â Â Â Â Â Â Â Â <option value="floating" ${a.rateType==='floating'?'selected':''}>æµ®åŠ¨</option>
Â Â Â Â Â Â Â Â Â Â Â Â <option value="locked" ${a.rateType==='locked'?'selected':''}>é”å®š</option>
Â Â Â Â Â Â Â Â Â Â </select>
Â Â Â Â Â Â Â Â </label>
Â Â Â Â Â Â </div>
Â Â Â Â Â Â <label>è§£æç±»å‹:
Â Â Â Â Â Â Â Â <select data-i="${i}" class="parseType">
Â Â Â Â Â Â Â Â Â Â <option value="json" ${a.parseType==='json'?'selected':''}>json</option>
Â Â Â Â Â Â Â Â Â Â <option value="html_regex" ${a.parseType==='html_regex'?'selected':''}>html_regex</option>
Â Â Â Â Â Â Â Â </select>
Â Â Â Â Â Â </label>
Â Â Â Â Â Â <label>è·¯å¾„/Regex: <input data-i="${i}" class="parsePath" value="${escapeHtml(a.parsePath||'')}" style="width:60%"></label><br>
Â Â Â Â Â Â <button data-i="${i}" class="del">åˆ é™¤</button>
Â Â Â Â `;
Â Â Â Â container.appendChild(div);
Â Â });

Â Â const update = (e,p)=>{adapters[e.target.dataset.i][p]=e.target.value;saveAdapters();};
Â Â container.querySelectorAll('.url').forEach(inp=>inp.onchange=e=>update(e,'urlTemplate'));
Â Â container.querySelectorAll('.linkTemplate').forEach(inp=>inp.onchange=e=>update(e,'linkTemplate'));
Â Â container.querySelectorAll('.rateType').forEach(sel=>sel.onchange=e=>update(e,'rateType'));
Â Â container.querySelectorAll('.parseType').forEach(sel=>sel.onchange=e=>update(e,'parseType'));
Â Â container.querySelectorAll('.parsePath').forEach(inp=>inp.onchange=e=>update(e,'parsePath'));
Â Â container.querySelectorAll('.del').forEach(btn=>btn.onclick=e=>{adapters.splice(e.target.dataset.i,1);saveAdapters();renderAdapters();});
}

document.getElementById('addAdapter').onclick = () => {
Â Â adapters.push({ name:'æ–°äº¤æ˜“æ‰€', urlTemplate:'https://api.example.com/quote?from={{from}}&to={{to}}', method:'GET', parseType:'json', parsePath:'data.rate', linkTemplate:'https://example.com/swap?from={{from}}&to={{to}}', rateType:'floating' });
Â Â saveAdapters(); renderAdapters();
};
document.getElementById('loadExample').onclick = () => {
Â Â adapters = [{
Â Â Â Â name:'ç¤ºä¾‹æµ®åŠ¨API',urlTemplate:'https://api.example.com/float?from={{from}}&to={{to}}',parseType:'json',parsePath:'data.floatRate',linkTemplate:'https://example.com/float/{{from}}-{{to}}',rateType:'floating'
Â Â }];
Â Â saveAdapters(); renderAdapters();
};
document.getElementById('compare').onclick = async ()=>{
Â Â const from=document.getElementById('from').value.trim().toUpperCase();
Â Â const to=document.getElementById('to').value.trim().toUpperCase();
Â Â if(!from||!to)return alert('è¯·è¾“å…¥å¸ç§');
Â Â if(!WORKER_URL.includes('https'))return alert('è¯·åœ¨é¡¶éƒ¨è®¾ç½®æ­£ç¡®çš„ Worker åœ°å€');
Â Â document.getElementById('status').textContent='æŸ¥è¯¢ä¸­...';
Â Â document.querySelector('#floatingTable tbody').innerHTML='';
Â Â document.querySelector('#lockedTable tbody').innerHTML='';
Â Â try{
Â Â Â Â const res=await fetch(WORKER_URL,{method:'POST',headers:{'content-type':'application/json'},body:JSON.stringify({pair:{from,to},adapters})});
Â Â Â Â const results=await res.json();
Â Â Â Â showResults(results);
Â Â Â Â document.getElementById('status').textContent=`æŸ¥è¯¢å®Œæˆï¼Œå…± ${results.length} æ¡ç»“æœ`;
Â Â }catch(e){document.getElementById('status').textContent='å¤±è´¥: '+e.message;}
};
function showResults(results){
Â Â const floating=results.filter(r=>r.rateType==='floating');
Â Â const locked=results.filter(r=>r.rateType==='locked');
Â Â const sortFn=(a,b)=>{
Â Â Â Â if(a.rate===null&&b.rate===null)return 0;
Â Â Â Â if(a.rate===null)return 1;if(b.rate===null)return -1;return b.rate-a.rate;
Â Â };
Â Â floating.sort(sortFn);locked.sort(sortFn);
Â Â renderTable(floating,'#floatingTable tbody');
Â Â renderTable(locked,'#lockedTable tbody');
}
function renderTable(data,selector){
Â Â const tbody=document.querySelector(selector);tbody.innerHTML='';
Â Â if(!data.length){tbody.innerHTML='<tr><td colspan=3 style="text-align:center;color:#666;">æ— æ•°æ®</td></tr>';return;}
Â Â data.forEach((r,i)=>{
Â Â Â Â const tr=document.createElement('tr');
Â Â Â Â const best=i===0&&r.ok&&r.rate!=null;
Â Â Â Â tr.innerHTML=`
Â Â Â Â Â Â <td>${r.name}</td>
Â Â Â Â Â Â <td>${r.ok&&r.rate!=null?(best?'ğŸ‘‘ <b style="color:red;">'+r.rate+'</b>':r.rate):'<span class="err">'+(r.error||'æ— ')+'</span>'}</td>
Â Â Â Â Â Â <td>${r.ok&&r.link?'<a href="'+r.link+'" target="_blank">å‰å¾€</a>':'-'}</td>`;
Â Â Â Â tbody.appendChild(tr);
Â Â });
}
renderAdapters();
</script>
</body>
</html>
