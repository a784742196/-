<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>âš¡ ä¸­æ–‡æ— KYC 8å®¶æ¯”ä»·ç¥å™¨ Â· V8.1 æ”¹è¿›ç‰ˆ</title>
<style>
Â Â body{font:20px system-ui;background:#000;color:#0f0;text-align:center;padding:20px;word-break:break-word}
Â Â input,button{margin:10px;padding:15px;font-size:20px;width:90%;border:2px solid #0f0;background:#000;color:#0f0;border-radius:12px}
Â Â .r{padding:15px;background:#111;border:1px solid #0f0;border-radius:12px;margin:10px;font-family:monospace;font-size:18px}
Â Â .best{color:#ff0;font-size:22px;font-weight:bold}
Â Â a{color:#0f0;text-decoration:underline}
Â Â .loading{color:#0ff;}
</style>
</head>
<body>
<h1>âš¡ ä¸­æ–‡ 8 å®¶æ—  KYC æ¯”ä»·ç¥å™¨ Â· V8.1 æ”¹è¿›å¢å¼ºç‰ˆ</h1>
ä»ï¼š<input list="fl" id="f" placeholder="btc / doge / sol"><br>
åˆ°ï¼š<input list="tl" id="t" placeholder="eth / usdt / bnb"><br>
é‡‘é¢ï¼š<input id="a" type="number" value="1" min="0" step="any"><br>
<button onclick="go()">âš¡ å¼€å§‹æ¯”ä»·ï¼ˆ8å®¶å¹¶è¡Œï¼‰</button>
<div id="o" class="loading">æ­£åœ¨åŠ è½½ 3500+ å¸ç§ä¸­ï¼Œè¯·ç¨å€™â€¦</div>
<datalist id="fl"></datalist>
<datalist id="tl"></datalist>

<script>
// ================== æ”¹è¿›ç‰ˆä»£ç†é…ç½® ==================
const proxyList = [
Â Â "https://corsproxy.io/?{url}",
Â Â "https://corsproxy.org/?{url}",
Â Â "https://api.allorigins.win/raw?url={url}"
];

// ================== å·¥å…·å‡½æ•° ==================
function getProxy(isPost = false, excludeProxy = "") {
Â Â let availableProxies = proxyList.filter(p => p !== excludeProxy);
Â Â if (isPost) availableProxies = availableProxies.filter(p => !p.includes("allorigins"));
Â Â return availableProxies.length ? availableProxies[Math.floor(Math.random() * availableProxies.length)] : "";
}

function fetchWithTimeout(resource, options = {}, timeout = 7000) {
Â Â return Promise.race([
Â Â Â Â fetch(resource, options),
Â Â Â Â new Promise((_, reject) => setTimeout(() => reject(new Error("timeout")), timeout))
Â Â ]).catch(err => {
Â Â Â Â if (err.message === "timeout") console.warn("Timeout URL:", resource);
Â Â Â Â throw err;
Â Â });
}

// ================== æ”¹è¿›ç‰ˆ fetchWithProxy ==================
async function fetchWithProxy(urlNoProxy, options = {}, timeout = 7000, isPost = false, proxyPrimary = "") {
Â Â const primary = proxyPrimary || getProxy(isPost);
Â Â const tryProxies = [];

Â Â if (primary) tryProxies.push(primary);
Â Â const others = proxyList.filter(p => p !== primary);
Â Â const filteredOthers = isPost ? others.filter(p => !p.includes("allorigins")) : others;
Â Â filteredOthers.forEach(p => tryProxies.push(p));

Â Â let lastErr = null;
Â Â const encoded = encodeURIComponent(urlNoProxy);

Â Â for (let proxy of tryProxies) {
Â Â Â Â try {
Â Â Â Â Â Â if (!proxy) continue;
Â Â Â Â Â Â let full = proxy.includes("{url}") ? proxy.replace(/{url}/g, encoded)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â : (proxy.endsWith("?") ? proxy + encoded
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â : (proxy.includes("?") ? proxy + "&url=" + encoded : proxy + "?url=" + encoded));
Â Â Â Â Â Â if (!full.startsWith("http")) throw new Error("invalid_proxy_url");
Â Â Â Â Â Â const res = await fetchWithTimeout(full, options, timeout);
Â Â Â Â Â Â if (!res.ok) throw new Error(`HTTP ${res.status}`);
Â Â Â Â Â Â return res;
Â Â Â Â } catch (e) {
Â Â Â Â Â Â console.warn(`Proxy ${proxy} failed for ${urlNoProxy}:`, e);
Â Â Â Â Â Â lastErr = e;
Â Â Â Â }
Â Â }

Â Â // æœ€åå°è¯•ç›´æ¥è¯·æ±‚
Â Â try {
Â Â Â Â const res = await fetchWithTimeout(urlNoProxy, options, timeout);
Â Â Â Â if (!res.ok) throw new Error(`HTTP ${res.status}`);
Â Â Â Â return res;
Â Â } catch (e) {
Â Â Â Â console.error("æ‰€æœ‰ä»£ç†ä¸ç›´è¿å‡å¤±è´¥:", e);
Â Â Â Â throw lastErr || e;
Â Â }
}

// ================== API Keysï¼ˆå¯é€‰ï¼‰ ==================
const changeNowKey = "";
const stealthExKey = "";
const letsExchangeKey = "";

if (!changeNowKey) console.warn("âš ï¸ å»ºè®®é…ç½® ChangeNOW API Key: https://changenow.io/developers");

// ================== æ„å»ºä»£ç†ç¼“å­˜ ==================
function buildProxyCache() {
Â Â return {
Â Â Â Â GET: getProxy(false),
Â Â Â Â POST: getProxy(true)
Â Â };
}

// ================== å„äº¤æ˜“æ‰€é…ç½® ==================
function buildSites(proxyCache) {
Â Â const pGET = proxyCache.GET;
Â Â const pPOST = proxyCache.POST;

Â Â return {
Â Â Â Â "ChangeNOW": {
Â Â Â Â Â Â fn:()=>fetchWithProxy(`https://api.changenow.io/v2/exchange/amount/${a()}/${f()}_to_${t()}?api_key=${changeNowKey}`, {}, 7000, false, pGET)
Â Â Â Â Â Â Â Â .then(r=>r.json()).then(j=>parseFloat(j?.toAmount||0)),
Â Â Â Â Â Â link:()=>`https://changenow.io/?from=${f()}&to=${t()}&amount=${a()}`
Â Â Â Â },
Â Â Â Â "Exolix": {
Â Â Â Â Â Â fn:()=>fetchWithProxy(`https://api.exolix.com/v2/rate?from=${f().toUpperCase()}&to=${t().toUpperCase()}&amount=${a()}&rateType=all`, {}, 7000, false, pGET)
Â Â Â Â Â Â Â Â .then(r=>r.json()).then(j=>parseFloat(j?.result?.amount||j?.amount||j?.toAmount||0)),
Â Â Â Â Â Â link:()=>`https://exolix.com/exchange?from=${f()}&to=${t()}&amount=${a()}`
Â Â Â Â },
Â Â Â Â "SimpleSwap": {
Â Â Â Â Â Â fn:()=>fetchWithProxy(`https://api.simpleswap.io/get_estimated?fixed=false&currency_from=${f()}&currency_to=${t()}&amount=${a()}`, {}, 7000, false, pGET)
Â Â Â Â Â Â Â Â .then(r=>r.json()).then(j=>parseFloat(j?.estimated||j?.result||0)),
Â Â Â Â Â Â link:()=>`https://simpleswap.io/?from=${f()}&to=${t()}&amount=${a()}`
Â Â Â Â },
Â Â Â Â "StealthEX": {
Â Â Â Â Â Â fn:()=>fetchWithProxy(`https://api.stealthex.io/api/v2/estimate/${f()}/${t()}?amount=${a()}&fixed=false&api_key=${stealthExKey}`, {}, 7000, false, pGET)
Â Â Â Â Â Â Â Â .then(r=>r.json()).then(j=>parseFloat(j?.estimated_amount||0)),
Â Â Â Â Â Â link:()=>`https://stealthex.io/?from=${f()}&to=${t()}&amount=${a()}`
Â Â Â Â },
Â Â Â Â "SwapSpace": {
Â Â Â Â Â Â fn:()=>fetchWithProxy(`https://api.swapspace.co/api/v1/estimate`,
Â Â Â Â Â Â Â Â {method:"POST",headers:{"Content-Type":"application/json"},
Â Â Â Â Â Â Â Â Â body:JSON.stringify({from:f(),to:t(),amount:a()})},
Â Â Â Â Â Â Â Â 7000,true,pPOST).then(r=>r.json()).then(j=>parseFloat(j?.best?.toAmount||0)),
Â Â Â Â Â Â link:()=>`https://swapspace.co/?from=${f()}&to=${t()}&amount=${a()}`
Â Â Â Â },
Â Â Â Â "Godex": {
Â Â Â Â Â Â fn:()=>fetchWithProxy(`https://api.godex.io/api/v1/info?from=${f().toUpperCase()}&to=${t().toUpperCase()}&amount=${a()}`, {}, 7000, false, pGET)
Â Â Â Â Â Â Â Â .then(r=>r.json()).then(j=>parseFloat(j?.amount||0)),
Â Â Â Â Â Â link:()=>`https://godex.io/?from=${f()}&to=${t()}&amount=${a()}`
Â Â Â Â },
Â Â Â Â "LetsExchange": {
Â Â Â Â Â Â fn:()=>fetchWithProxy(`https://api.letsexchange.io/api/v1/info`,
Â Â Â Â Â Â Â Â {method:"POST",headers:{"Content-Type":"application/json"},
Â Â Â Â Â Â Â Â Â body:JSON.stringify({from:f(),to:t(),amount:a(),api_key:letsExchangeKey})},
Â Â Â Â Â Â Â Â 7000,true,pPOST).then(r=>r.json()).then(j=>parseFloat(j?.toAmount||0)),
Â Â Â Â Â Â link:()=>`https://letsexchange.io/?from=${f()}&to=${t()}&amount=${a()}`
Â Â Â Â },
Â Â Â Â "FixedFloat": {
Â Â Â Â Â Â fn:()=>fetchWithProxy(`https://ff.io/api/v2/price?from=${f().toUpperCase()}&to=${t().toUpperCase()}&amount=${a()}&type=float`, {}, 7000, false, pGET)
Â Â Â Â Â Â Â Â .then(r=>r.json()).then(j=>parseFloat((!j?.error && j?.to)? j.to : 0)),
Â Â Â Â Â Â link:()=>`https://ff.io/?from=${f()}&to=${t()}&amount=${a()}`
Â Â Â Â }
Â Â };
}

// ================== å¸ç§åŠ è½½ ==================
function loadCurrencies() {
Â Â const primaryUrl = "https://api.swapspace.co/v1/currencies";
Â Â const fallbackUrl = "https://api.simpleswap.io/get_all_currencies";

Â Â fetch(primaryUrl)
Â Â Â Â .then(r=>r.json())
Â Â Â Â .then(d=>{
Â Â Â Â Â Â if (d && d.length) renderCurrencies(d);
Â Â Â Â Â Â else throw new Error("empty");
Â Â Â Â })
Â Â Â Â .catch(()=>{
Â Â Â Â Â Â fetch(fallbackUrl)
Â Â Â Â Â Â Â Â .then(r=>r.json())
Â Â Â Â Â Â Â Â .then(d=>{
Â Â Â Â Â Â Â Â Â Â const mapped = Object.keys(d||{}).map(k=>({ticker:k,name:d[k].name||k}));
Â Â Â Â Â Â Â Â Â Â renderCurrencies(mapped);
Â Â Â Â Â Â Â Â })
Â Â Â Â Â Â Â Â .catch(()=>{ document.getElementById("o").innerHTML="âš ï¸ å¸ç§åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•ã€‚"; });
Â Â Â Â });
}

function renderCurrencies(data){
Â Â const h = data.map(c=>`<option value="${c.ticker.toLowerCase()}">${c.name}</option>`).join("");
Â Â document.getElementById("fl").innerHTML = document.getElementById("tl").innerHTML = h;
Â Â document.getElementById("o").innerHTML = "âœ… å¸ç§åŠ è½½å®Œæˆï¼Œè¾“å…¥ç®€ç§°å³å¯è‡ªåŠ¨è¡¥å…¨ã€‚";
}

loadCurrencies();

// ================== è¾“å…¥å‡½æ•° ==================
let f=()=>document.getElementById("f").value.trim().toLowerCase();
let t=()=>document.getElementById("t").value.trim().toLowerCase();
let a=()=>Number(document.getElementById("a").value)||1;

// ================== ä¸»é€»è¾‘ ==================
async function go(){
Â Â if(!f()||!t()) { alert("è¯·å¡«å†™å¸å¯¹ï¼ˆä¾‹å¦‚ï¼šä» btc åˆ° ethï¼‰"); return; }

Â Â document.getElementById("o").innerHTML="<div class='r loading'>æ­£åœ¨åŒæ—¶æŸ¥è¯¢ 8 å®¶æ±‡ç‡ï¼Œè¯·ç¨å€™â€¦</div>";

Â Â const proxyCache = buildProxyCache();
Â Â const sitesObj = buildSites(proxyCache);

Â Â let html="", best=0, bestName="", bestLink="";
Â Â const results = await Promise.all(Object.entries(sitesObj).map(async([n,obj])=>{
Â Â Â Â try{
Â Â Â Â Â Â const r = await obj.fn();
Â Â Â Â Â Â if (isNaN(r) || r <= 0) throw new Error("invalid");
Â Â Â Â Â Â return {name:n,result:r,link:obj.link()};
Â Â Â Â }catch(e){
Â Â Â Â Â Â console.warn(`[${n}] æŸ¥è¯¢å¤±è´¥`, e);
Â Â Â Â Â Â return {name:n,result:"è¶…æ—¶/å¤±è´¥"};
Â Â Â Â }
Â Â }));

Â Â results.sort((a,b)=>{
Â Â Â Â const aNum = typeof a.result === "number";
Â Â Â Â const bNum = typeof b.result === "number";
Â Â Â Â if (aNum && !bNum) return -1;
Â Â Â Â if (!aNum && bNum) return 1;
Â Â Â Â if (aNum && bNum) return b.result - a.result;
Â Â Â Â return 0;
Â Â });

Â Â for (const it of results) {
Â Â Â Â if (typeof it.result === "number") {
Â Â Â Â Â Â best = it.result; bestName = it.name; bestLink = it.link; break;
Â Â Â Â }
Â Â }

Â Â results.forEach(item=>{
Â Â Â Â if (typeof item.result === "number") {
Â Â Â Â Â Â const rVal = item.result.toFixed(6);
Â Â Â Â Â Â html += `<div class=r>${item.name}<br>â†’ ${rVal} ${t().toUpperCase()}<br><a href="${item.link}" target="_blank">å»å…‘æ¢</a></div>`;
Â Â Â Â } else {
Â Â Â Â Â Â html += `<div class=r>${item.name}<br>â†’ è¶…æ—¶æˆ–å¤±è´¥</div>`;
Â Â Â Â }
Â Â });

Â Â if (bestName) {
Â Â Â Â html = `<div class="r best">â˜… ${bestName} æ±‡ç‡æœ€ä½³ï¼<br>æ±‡ç‡ï¼š${best.toFixed(6)} ${t().toUpperCase()}<br><a href="${bestLink}" target="_blank" style="font-size:28px">âš¡ ç«‹å³è·³è½¬ä¸‹å•</a></div>` + html;
Â Â } else {
Â Â Â Â html = `<div class="r best">âŒ æ‰€æœ‰äº¤æ˜“æ‰€æŸ¥è¯¢å¤±è´¥æˆ–è¶…æ—¶ã€‚</div>` + html;
Â Â }

Â Â html += `<br><button onclick="go()">ğŸ”„ é‡æ–°æŸ¥è¯¢</button>`;
Â Â document.getElementById("o").innerHTML = html;
}
</script>
</body>
</html>
